// --- Índices recomendados e criação

// 1) Users
// - email: lookup único por login/recuperação (alta seletividade) -> único
// - location: buscas por proximidade -> 2dsphere
db.users.createIndex({ email: 1 }, { unique: true, name: "idx_users_email_unique" });
db.users.createIndex({ location: "2dsphere" }, { name: "idx_users_location_2dsphere" });

// 2) Categories
// - name: busca por nome/categoria (poucas escritas, muitas leituras)
db.categories.createIndex({ name: 1 }, { name: "idx_categories_name" });

// 3) Products
// - categoryId: filtrar produtos por categoria
// - sellerId: relatórios por vendedor / consultas do vendedor
// - location: geolocalização para buscar por proximidade
// - text index em name + description: buscas de texto completo
// - compound (categoryId, price): filtrar por categoria e ordenar/filtrar por preço eficientemente
db.products.createIndex({ categoryId: 1 }, { name: "idx_products_categoryId" });
db.products.createIndex({ sellerId: 1 }, { name: "idx_products_sellerId" });
db.products.createIndex({ location: "2dsphere" }, { name: "idx_products_location_2dsphere" });
db.products.createIndex({ name: "text", description: "text" }, { name: "idx_products_text_name_desc" });
db.products.createIndex({ categoryId: 1, price: 1 }, { name: "idx_products_category_price" });

// 4) Reviews
// - productId: recuperar todas as avaliações de um produto
// - userId: histórico do usuário
// - productId + rating: agregações de média por produto
db.reviews.createIndex({ productId: 1, date: -1 }, { name: "idx_reviews_product_date" });
db.reviews.createIndex({ userId: 1 }, { name: "idx_reviews_user" });
db.reviews.createIndex({ productId: 1, rating: -1 }, { name: "idx_reviews_product_rating" });

// 5) Orders
// - buyerId + date: histórico de pedidos por comprador (ordenado por data)
// - status + date: filas/monitoramento por status em janelas temporais
// - items.productId: agregações para total de vendas por produto/categoria (items é array)
db.orders.createIndex({ buyerId: 1, date: -1 }, { name: "idx_orders_buyer_date" });
db.orders.createIndex({ status: 1, date: -1 }, { name: "idx_orders_status_date" });
db.orders.createIndex({ "items.productId": 1 }, { name: "idx_orders_items_productId" });

// Lista de índices criados (verificação rápida)
print("Indexes created:");
printjson({
  users: db.users.getIndexes(),
  categories: db.categories.getIndexes(),
  products: db.products.getIndexes(),
  reviews: db.reviews.getIndexes(),
  orders: db.orders.getIndexes()
});
